jQuery(function(a){var o,n;jQuery("#wcf-pre-checkout-offer-modal").length<1||(o="",jQuery("form.checkout").on("checkout_place_order.wcf_pre_checkout",function(e){if("add"===jQuery(".wcf-pre-checkout-offer-action").val())return setTimeout(function(){var u;u=jQuery("form.checkout").find('input[name="payment_method"]:checked').val(),o=u,jQuery(".wcf_validation_error").remove(),jQuery("form.checkout").addClass("loader").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a.ajax({url:wc_checkout_params.wc_ajax_url.toString().replace("%%endpoint%%","wcf_validate_form"),data:a("form.checkout").serialize(),dataType:"json",type:"POST",success:function(c){try{if(jQuery("form.checkout").removeClass("loader").unblock(),"success"!=c.result)throw"failure"===c.result?"Result failure":"Invalid response";var e,o,r,t,f;"yes"==("authorize_net_cim_credit_card"===u||null==(e=jQuery("form.checkout").triggerHandler("checkout_place_order_"+u))||null!=e&&1==e?"yes":"no")&&(o=jQuery("#billing_first_name").val(),null!=(t=(r=jQuery(".wcf-pre-checkout-offer-wrapper .wcf-content-modal-title h1").text()).match(/{([^}]+)}/))&&0!=o.length&&(f="first_name"===t[1]?r.replace(/{(.*?)}/,'<span class="wcf_first_name"></span>'):r.replace(/{(.*?)}/,""),a(".wcf-pre-checkout-offer-wrapper .wcf-content-modal-title h1").html(f),a(".wcf_first_name").text(o)),a(".wcf-pre-checkout-offer-wrapper").addClass("open"),a("html").addClass("wcf-pre-checkout-offer-open"),a(".wcf-pre-checkout-offer-action").val(""),setTimeout(function(){n()},100))}catch(e){c.messages&&(jQuery("form.checkout").prepend('<div class="wcf_validation_error">'+c.messages+"</div>"),jQuery("form.checkout").removeClass("processing").unblock(),jQuery("form.checkout").find(".input-text, select, input:checkbox").trigger("validate").blur(),(c=a(".wcf_validation_error")).length||(c=a(".form.checkout")),a.scroll_to_notices(c))}}})},100),!1}),a("body").on("click",".wcf-pre-checkout-offer-btn",function(e){e.preventDefault(),$checkoutForm=a(".wcf-pre-checkout-offer-btn").find("form.checkout");e=a("._wcf_checkout_id").val();""!=e&&(a(".wcf-pre-checkout-offer-btn").html(cartflows.add_to_cart_text),a.ajax({url:cartflows.ajax_url,data:{action:"wcf_add_to_cart",product_quantity:1,checkout_id:e,security:cartflows.wcf_pre_checkout_offer_nonce},dataType:"json",type:"POST",success:function(c){jQuery("form.checkout").off("checkout_place_order.wcf_pre_checkout"),"authorize_net_cim_credit_card"===o?(a("body").trigger("update_checkout",{update_shipping_method:!1}),a(document.body).on("updated_checkout.wcf_pre_checkout",function(e){a(".wcf-pre-checkout-offer-action").val(""),a(".wcf-pre-checkout-offer-btn").html(c.message),a(".wcf-pre-checkout-offer-wrapper").removeClass("open"),a("html").removeClass("wcf-pre-checkout-offer-open"),a("form.checkout").submit(),a(document.body).off("updated_checkout.wcf_pre_checkout")})):(a(".wcf-pre-checkout-offer-action").val(""),a(".wcf-pre-checkout-offer-btn").html(c.message),setTimeout(function(){a(".wcf-pre-checkout-offer-wrapper").removeClass("open"),a("html").removeClass("wcf-pre-checkout-offer-open"),a("form.checkout").submit()},600))}}))}),a("body").on("click",".wcf-pre-checkout-skip",function(){jQuery("form.checkout").off("checkout_place_order.wcf_pre_checkout"),a(".wcf-pre-checkout-offer-action").val(""),a(".wcf-pre-checkout-offer-wrapper").removeClass("open"),a("html").removeClass("wcf-pre-checkout-offer-open"),a("form.checkout").submit()}),a(window).on("resize",function(){n()}),n=function(){a(window).height()<a("#wcf-pre-checkout-offer-modal").height()?a("html").removeClass("wcf-pre-checkout-screen-size"):a("html").addClass("wcf-pre-checkout-screen-size")})});